{"ast":null,"code":"import ReactDOM from 'react-dom';\nimport { Editor } from 'slate';\n// import { ReactEditor } from 'slate-react';\nimport { splitEditorInTwoFragments } from '@plone/volto-slate/utils/ops';\nimport { setEditorContent } from '@plone/volto-slate/utils/editor';\nimport { createAndSelectNewBlockAfter } from '@plone/volto-slate/utils/volto-blocks';\nimport { rangeIsInSplittableNode } from '@plone/volto-slate/utils/internals';\n\n/**\n * @param {Editor} editor The Slate editor object to extend.\n * @param {Object} intl intl object.\n * @description If the selection exists and touches with one of its edges a\n * closest-to-root `Text` node (`Path` with length `2`)\n *\n *   - if the parent node of the selection exists, split editor into two\n *     fragments put inside separate Volto Slate Text blocks;\n *   - if the parent node of the selection does not exist, do nothing;\n *\n * and if the selection does not exist or does not touch with one of its edges a\n * closest-to-root `Text` node, call the default behavior.\n */\nexport const withSplitBlocksOnBreak = (editor, intl) => {\n  const {\n    insertBreak\n  } = editor;\n  editor.insertBreak = () => {\n    // if selection is expanded, delete it\n    if (rangeIsInSplittableNode(editor, editor.selection)) {\n      const block = Editor.parent(editor, editor.selection);\n      if (block) {\n        const blockProps = editor.getBlockProps();\n        const {\n          data\n        } = blockProps;\n\n        // Don't add new block if not allowed\n        if (data !== null && data !== void 0 && data.disableNewBlocks || blockProps.detached) {\n          return insertBreak();\n        }\n\n        // TODO: another method would be to simply insert a break and call\n        // deconstructToVoltoBlocks\n        ReactDOM.unstable_batchedUpdates(() => {\n          const [top, bottom] = splitEditorInTwoFragments(editor);\n          // ReactEditor.blur(editor);\n          createAndSelectNewBlockAfter(editor, bottom, intl);\n          setEditorContent(editor, top);\n        });\n      }\n      return;\n    }\n    return insertBreak();\n  };\n  return editor;\n};","map":{"version":3,"names":["ReactDOM","Editor","splitEditorInTwoFragments","setEditorContent","createAndSelectNewBlockAfter","rangeIsInSplittableNode","withSplitBlocksOnBreak","editor","intl","insertBreak","selection","block","parent","blockProps","getBlockProps","data","disableNewBlocks","detached","unstable_batchedUpdates","top","bottom"],"sources":["/Users/varshanmaji/Projects/volto/packages/volto-slate/src/blocks/Text/extensions/insertBreak.js"],"sourcesContent":["import ReactDOM from 'react-dom';\nimport { Editor } from 'slate';\n// import { ReactEditor } from 'slate-react';\nimport { splitEditorInTwoFragments } from '@plone/volto-slate/utils/ops';\nimport { setEditorContent } from '@plone/volto-slate/utils/editor';\nimport { createAndSelectNewBlockAfter } from '@plone/volto-slate/utils/volto-blocks';\nimport { rangeIsInSplittableNode } from '@plone/volto-slate/utils/internals';\n\n/**\n * @param {Editor} editor The Slate editor object to extend.\n * @param {Object} intl intl object.\n * @description If the selection exists and touches with one of its edges a\n * closest-to-root `Text` node (`Path` with length `2`)\n *\n *   - if the parent node of the selection exists, split editor into two\n *     fragments put inside separate Volto Slate Text blocks;\n *   - if the parent node of the selection does not exist, do nothing;\n *\n * and if the selection does not exist or does not touch with one of its edges a\n * closest-to-root `Text` node, call the default behavior.\n */\nexport const withSplitBlocksOnBreak = (editor, intl) => {\n  const { insertBreak } = editor;\n\n  editor.insertBreak = () => {\n    // if selection is expanded, delete it\n    if (rangeIsInSplittableNode(editor, editor.selection)) {\n      const block = Editor.parent(editor, editor.selection);\n\n      if (block) {\n        const blockProps = editor.getBlockProps();\n        const { data } = blockProps;\n\n        // Don't add new block if not allowed\n        if (data?.disableNewBlocks || blockProps.detached) {\n          return insertBreak();\n        }\n\n        // TODO: another method would be to simply insert a break and call\n        // deconstructToVoltoBlocks\n        ReactDOM.unstable_batchedUpdates(() => {\n          const [top, bottom] = splitEditorInTwoFragments(editor);\n          // ReactEditor.blur(editor);\n          createAndSelectNewBlockAfter(editor, bottom, intl);\n          setEditorContent(editor, top);\n        });\n      }\n      return;\n    }\n\n    return insertBreak();\n  };\n\n  return editor;\n};\n"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,WAAW;AAChC,SAASC,MAAM,QAAQ,OAAO;AAC9B;AACA,SAASC,yBAAyB,QAAQ,8BAA8B;AACxE,SAASC,gBAAgB,QAAQ,iCAAiC;AAClE,SAASC,4BAA4B,QAAQ,uCAAuC;AACpF,SAASC,uBAAuB,QAAQ,oCAAoC;;AAE5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,sBAAsB,GAAGA,CAACC,MAAM,EAAEC,IAAI,KAAK;EACtD,MAAM;IAAEC;EAAY,CAAC,GAAGF,MAAM;EAE9BA,MAAM,CAACE,WAAW,GAAG,MAAM;IACzB;IACA,IAAIJ,uBAAuB,CAACE,MAAM,EAAEA,MAAM,CAACG,SAAS,CAAC,EAAE;MACrD,MAAMC,KAAK,GAAGV,MAAM,CAACW,MAAM,CAACL,MAAM,EAAEA,MAAM,CAACG,SAAS,CAAC;MAErD,IAAIC,KAAK,EAAE;QACT,MAAME,UAAU,GAAGN,MAAM,CAACO,aAAa,CAAC,CAAC;QACzC,MAAM;UAAEC;QAAK,CAAC,GAAGF,UAAU;;QAE3B;QACA,IAAIE,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEC,gBAAgB,IAAIH,UAAU,CAACI,QAAQ,EAAE;UACjD,OAAOR,WAAW,CAAC,CAAC;QACtB;;QAEA;QACA;QACAT,QAAQ,CAACkB,uBAAuB,CAAC,MAAM;UACrC,MAAM,CAACC,GAAG,EAAEC,MAAM,CAAC,GAAGlB,yBAAyB,CAACK,MAAM,CAAC;UACvD;UACAH,4BAA4B,CAACG,MAAM,EAAEa,MAAM,EAAEZ,IAAI,CAAC;UAClDL,gBAAgB,CAACI,MAAM,EAAEY,GAAG,CAAC;QAC/B,CAAC,CAAC;MACJ;MACA;IACF;IAEA,OAAOV,WAAW,CAAC,CAAC;EACtB,CAAC;EAED,OAAOF,MAAM;AACf,CAAC","ignoreList":[]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}