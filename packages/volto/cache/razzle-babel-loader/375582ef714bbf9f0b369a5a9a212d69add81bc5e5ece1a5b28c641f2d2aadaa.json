{"ast":null,"code":"import express from 'express';\nimport { getAPIResourceWithAuth } from '@plone/volto/helpers/Api/APIResourceWithAuth';\nconst HEADERS = ['content-type', 'content-disposition', 'cache-control', 'x-sendfile', 'x-accel-redirect', 'x-robots-tag'];\nfunction imageMiddlewareFn(req, res, next) {\n  getAPIResourceWithAuth(req).then(resource => {\n    // Just forward the headers that we need\n    HEADERS.forEach(header => {\n      if (resource.headers[header]) {\n        res.set(header, resource.headers[header]);\n      }\n    });\n    res.send(resource.body);\n  }).catch(next);\n}\nexport default function imagesMiddleware() {\n  const middleware = express.Router();\n  middleware.all(['**/@@images/*'], imageMiddlewareFn);\n  middleware.all(['/@portrait/*'], imageMiddlewareFn);\n  middleware.all(['/@@site-logo/*'], imageMiddlewareFn);\n  middleware.id = 'imageResourcesProcessor';\n  return middleware;\n}","map":{"version":3,"names":["express","getAPIResourceWithAuth","HEADERS","imageMiddlewareFn","req","res","next","then","resource","forEach","header","headers","set","send","body","catch","imagesMiddleware","middleware","Router","all","id"],"sources":["/Users/varshanmaji/Projects/volto/packages/volto/src/express-middleware/images.js"],"sourcesContent":["import express from 'express';\nimport { getAPIResourceWithAuth } from '@plone/volto/helpers/Api/APIResourceWithAuth';\n\nconst HEADERS = [\n  'content-type',\n  'content-disposition',\n  'cache-control',\n  'x-sendfile',\n  'x-accel-redirect',\n  'x-robots-tag',\n];\n\nfunction imageMiddlewareFn(req, res, next) {\n  getAPIResourceWithAuth(req)\n    .then((resource) => {\n      // Just forward the headers that we need\n      HEADERS.forEach((header) => {\n        if (resource.headers[header]) {\n          res.set(header, resource.headers[header]);\n        }\n      });\n      res.send(resource.body);\n    })\n    .catch(next);\n}\n\nexport default function imagesMiddleware() {\n  const middleware = express.Router();\n\n  middleware.all(['**/@@images/*'], imageMiddlewareFn);\n  middleware.all(['/@portrait/*'], imageMiddlewareFn);\n  middleware.all(['/@@site-logo/*'], imageMiddlewareFn);\n  middleware.id = 'imageResourcesProcessor';\n  return middleware;\n}\n"],"mappings":"AAAA,OAAOA,OAAO,MAAM,SAAS;AAC7B,SAASC,sBAAsB,QAAQ,8CAA8C;AAErF,MAAMC,OAAO,GAAG,CACd,cAAc,EACd,qBAAqB,EACrB,eAAe,EACf,YAAY,EACZ,kBAAkB,EAClB,cAAc,CACf;AAED,SAASC,iBAAiBA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;EACzCL,sBAAsB,CAACG,GAAG,CAAC,CACxBG,IAAI,CAAEC,QAAQ,IAAK;IAClB;IACAN,OAAO,CAACO,OAAO,CAAEC,MAAM,IAAK;MAC1B,IAAIF,QAAQ,CAACG,OAAO,CAACD,MAAM,CAAC,EAAE;QAC5BL,GAAG,CAACO,GAAG,CAACF,MAAM,EAAEF,QAAQ,CAACG,OAAO,CAACD,MAAM,CAAC,CAAC;MAC3C;IACF,CAAC,CAAC;IACFL,GAAG,CAACQ,IAAI,CAACL,QAAQ,CAACM,IAAI,CAAC;EACzB,CAAC,CAAC,CACDC,KAAK,CAACT,IAAI,CAAC;AAChB;AAEA,eAAe,SAASU,gBAAgBA,CAAA,EAAG;EACzC,MAAMC,UAAU,GAAGjB,OAAO,CAACkB,MAAM,CAAC,CAAC;EAEnCD,UAAU,CAACE,GAAG,CAAC,CAAC,eAAe,CAAC,EAAEhB,iBAAiB,CAAC;EACpDc,UAAU,CAACE,GAAG,CAAC,CAAC,cAAc,CAAC,EAAEhB,iBAAiB,CAAC;EACnDc,UAAU,CAACE,GAAG,CAAC,CAAC,gBAAgB,CAAC,EAAEhB,iBAAiB,CAAC;EACrDc,UAAU,CAACG,EAAE,GAAG,yBAAyB;EACzC,OAAOH,UAAU;AACnB","ignoreList":[]},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}